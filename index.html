<html>
<head>
<title>sleepyti.me bedtime calculator</title>
<script src="jquery.js"></script>
<script>
$(document).ready(function() {
	// render the page -- in case you're wondering, 
	// nothing will work without javascript!
	$("#tit").html('<font face="Garamond"><h1>&nbsp;&nbsp;<i>sleepyti.me <font color="#33CC33">beta</font></i></h1></font>');
	var mrend = '';
	mrend = mrend +
	'<table><tr width="100%">' +
	'<td width="20%"></td>' +
	'<td><font face="Garamond" size=5>I have to wake up at <span class="waketime" style="display:none;"></span>&nbsp;</td>' +
	'<td>' +
	'<select id="hour">' +
	'<option>(hour)</option>';
	
	// populate our lists
	for(var h = 1; h <= 12; h++) {
		mrend = mrend + '<option>' + h + '</option>';	
	}
	
	mrend = mrend + '</select></td><td><select id="minute"><option>(minute)</option>';
	
	for(var m = 0; m <= 55; m += 5) {
		if(m < 10) {
			mrend = mrend + '<option value="' + m + '">0' + m + '</option>';
		}
		else {
			mrend = mrend + '<option>' + m + '</option>';
		}
		
	}
	
	mrend = mrend + '</select></td><td><select id="ampm">' + 
	'<option>AM</option><option>PM</option></select></td></tr><td></td>' +
	'<td><span class="results" style="display:none;"></span></td>' + 
	'</tr></table>';
	
	$('#main').html(mrend);
	
	// calculates an hour and a half back
	function sleepback(hr, min, an) {
                var rmin = 0;
                var rhr = 0;
                var a = an;
                if(min < 30) {
                        rmin = (min * 1) + (30 * 1);
                        rhr = hr - 2;
                }
                else if(min >= 30) {
                        rmin = min - 30;
                        rhr = hr - 1;
                }
                if(rhr < 1) {
                        rhr = 12 + rhr;
                        
			if(a == "AM") {
				a = "PM";
			}
			else {
				a = "AM";
			}
			
                }
                
		var r = [rhr, rmin, a];
		return r;
	}
	
	// user changes the list, so we calculate times!
	$("#main select").change(function () {
		if($("#hour").val() == '(hour)' || $("#minute").val() == '(minute)') {
			return false;
		}
		var ampm = $("#ampm").val();	
		var hr = $("#hour").val();
		var min = $("#minute").val();
		var orig = [hr, min, ampm];
		
		if(hr == 12) {
			if(ampm == "AM") {
				ampm = "PM";
			}
			else {
				ampm = "AM";
			}
		}
		
		var txt = '<font face="Garamond" size=5><br/><br/>You should try to <b>fall asleep</b> at one of the following times:<br/><br/><font size=6>';
		var first = true;
		
		for(var c = 1; c <= 10; c++) {
			var back = sleepback(hr, min, ampm);
			var nhr = back[0];
			var nmin = back[1];
			ampm = back[2];
			var ampmt = "";
			ampmt = back[2];
			// countdown from 12, but that's not
			// how am/pm system works... whoops!
			if(nhr == 12) {
				if(ampm == "AM") {
					ampmt = "PM";
				}
				else {
					ampmt = "AM";
				}
			}
			
			if(c == 6 || c == 4 || c == 5 || c == 3) {
				if(nmin > 9) {
					if(first == true) {
						first = false;
						txt = txt + '<font color="#01DF74" size="7">' + nhr + ':' + nmin + ' ' + ampmt + '</font>';
					}
					else {
						txt = txt + ' <i>or</i> ' + '<font color="#01DF74" size="7">' + nhr + ':' + nmin + ' ' + ampmt + '</font>';
					}
				}
				else {
                                        if(first == true) {
                                                first = false;
                                                txt = txt + '<font color="#01DF74" size="7">' + nhr + ':0' + nmin + ' ' + ampmt + '</font>';
                                        }
                                        else {
                                                txt = txt + ' <i>or</i> ' + '<font color="#01DF74" size="7">' + nhr + ':0' + nmin + ' ' + ampmt + '</font>';
                                        }
				}
			}
			hr = nhr;
			min = nmin;
		}
		txt = txt + '</font>'; 
		
		txt = txt + '<br/><br/><font color="#0080FF">Please keep in mind that you should be <i>falling asleep</i> at these times.<br/><br/> The average adult human takes <b>fourteen minutes</b> to fall asleep, so plan accordingly!</font>';
		txt = txt + '<br/></br><font color="#9966CC">sleepyti.me works by counting backwards in <b>sleep cycles</b>. Sleep cycles typically last <b>90 minutes</b>.<br/><br/>Waking up in the middle of a sleep cycle leaves you feeling tired and groggy, but waking up <i>in between</i> cycles lets you wake up feeling refreshed and alert!</font>';
		txt = txt + '<br/><br/><br/><br/><br/><br/><span class="donate" style="display:none;"></span>';
		$('.results').html(txt);
		$('.results').fadeIn(1000);
		
		donate = '<font face="Garamond" size=5 color="#CCCCCC"><table><tr height="100%"><td valign="bottom">Are you waking up refreshed because of sleepyti.me? Consider donating to support this free and open source project!<br/><br/>' +
		'<center>' +
		'<form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_s-xclick">' +
		'<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----">' +
		'<input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">' +
		'<img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1"></form>';
		donate = donate + '<br/><br/><center><font face="Garamond"><h2>&copy; <a href="http://github.com/davidshaw/dshaw_resume/raw/master/dshaw_resume_2010.pdf">David Shaw</a>, 2010</font></h2></center>';
		$('.donate').html(donate);
		$('.donate').fadeIn(1000); // necessary?
		var wtime = "";
		if(orig[1] > 9) {
			wtime = '<b>' + orig[0] + ':' + orig[1] + ' ' + orig[2] + '</b>';	
		}
		else {
			wtime = '<b>' + orig[0] + ':0' + orig[1] + ' ' + orig[2] + '</b>';
		}
		$('.waketime').html(wtime);
		$('.waketime').fadeIn(1000);
	});
});
</script>
</head>
<body>
<div id="tit"></div>
<div id="main"></div>
</body>
</html>
